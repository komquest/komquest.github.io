# Article SessionManager

https://securelist.com/the-sessionmanager-iis-backdoor/106868/



---

# Article STRONTIUM credential harvesting

---

This shift in tactics, also made by several other nation-state actors, allows them to execute large-scale credential harvesting operations in a more anonymized manner.

---

During the two-week period, August 19 – September 3, STRONTIUM’s credential harvesting tooling utilized a daily average of 1,294 IPs associated with 536 netblocks and 273 ASNs

---

The fact that the anonymization service is over-serving specific netblocks gives **defenders an opportunity to hunt for activity associated both with this STRONTIUM activity or other malicious tooling that is utilizing the same anonymization service**.

---

In **password-spray mode**, the tooling attempts username: password combinations in a ‘low-‘n-slow’ manner.

In **brute-force mode**, the tooling attempts many username: password attempts very rapidly for a much shorter time period.

---

Password spray is an increasingly common tactic of nation-state actors.

---

**Attack Simulator in Office 365 ATP lets you run realistic, but simulated phishing and password attack campaigns in your organization.** Pick a password and then run the campaign against as many users as you want. The results will let you know how many people are using that password. Use the data to train users and build your custom list of banned passwords.

---

https://www.microsoft.com/security/blog/2020/09/10/strontium-detecting-new-patters-credential-harvesting/

#Tags

Credentials
Microsoft Office 365
Password Spay
Brute Force
Tor
Anonymizer Service 

# Article Drovorub (Russian Linux Malware)

**Russian General Staff Main Intelligence Directorate (GRU)** 85th Main SpecialService Center (GTsSS)

------


While **packetinspection at network boundaries can be used to detect Drovorub on networks,** host-based methods include probing, security products, live response, memory analysis, and media (disk image) analysis.

------
#Components

 [image.png](https://trello-attachments.s3.amazonaws.com/5d76ecf95050b2072d7c91fc/5dad7e61a7828b24c46b9a3d/b6b02222d84522dce7447827e12dec64/image.png) 

------

The GTsSS cyber program uses a wide variety of **proprietary and publicly known techniques to gain access to target networks and to persist their malware** on compromised devices.

------

#Add kernel modules to Redhat linux:

```bash

.modules executable script within "/etc/sysconfig/modules/"
add kernel module to /etc/modules.conf
placing a .conf file within /etc/modules-load.d/


```

------

Of particular importance, the WebSocket protocol implements a feature called "masking", that affects how traffic appears on the network. **Per RFC 6455, every WebSocket client message sent to a WebSocket server is XOR "masked" with a random 4-byte value that is unique for each message.** The XOR value is passed in the message frame header so the payload data can be de-obfuscated by the WebSocket server. WebSocket server-to-client traffic is not XOR "masked". In the case of Drovorub, Drovorub-servers act as WebSocket servers while Drovorub-clients and Drovorub-agents act as WebSocket clients. **Therefore, all traffic sent from a Drovorub-server to a Drovorub-client or Drovorub-agent will be readable as plaintext JSON messages, whereas traffic to the Drovorub-server will appear to be random data because of the XOR masking.**

------

For the Drovorub-client, the Drovorub-server **IP address and port information is embedded within the executable**, whereas for the Drovorub-agent, it is contained the Drovorub-agent's configuration file.

--> Note, this can also be a domain name as per writeup

------

**Essential to implementation of its hiding capabilities,kernel functions are hooked,either by patching the functions directly or by overwriting function pointers that point to the functions.** Using this technique, the Drovorub-kernel module institutes: process hiding, file hiding, socket hiding, net filter hiding, and hiding from raw socket receives.

------

A number of complementary detection techniques effectively identify Drovorub malware activity. However, the **Drovorub-kernel module poses a challenge to large-scale detection on the host because it hides Drovorub artifacts from tools commonly used for live-response at scale.**

------

**dynamically de-obfuscate “masked” WebSocket protocol messages via scripting capabilities.**

Using a **TLSproxy at the network boundary would allow for the detection of command and control messages** even under a TLS encrypted channel.

------

Capturing and analyzing the running memory of an endpoint is the most effective approach in detecting the Drovorub-kernel module because it offers the greatest insight into the behaviors the rootkit takes to hide itself and other artifacts on the system. **Publically available tools such as Linux Memory Grabber (LMG), LiME and Volatility,or Rekall can be used to acquire and analyze memory.** Detailed guidance for revealing Drovorub-kernel module behaviors is provided in the Memory Analysis with Volatilitysection below.

------

touch testfile
echo “ASDFZXCV:hf:testfile” > **/dev/zero**
ls

------

https://media.defense.gov/2020/Aug/13/2002476465/-1/-1/0/CSA_DROVORUB_RUSSIAN_GRU_MALWARE_AUG_2020.PDF

#Tags

Hooking (Files, Process, Socket hiding)
C2
/dev/zero rewrite
WebSocket XOR obfuscation
Hidden Kernel Module
Russian State Malware
Rootkit
Linux


# Article Wasted Locker

**Ransomware creators are acutely aware that network or endpoint security controls pose a fatal threat to any operation**, so they’ve developed a fixation on building complex logic for detecting and subverting those controls. Modern ransomware spends an inordinate amount of time attempting to thwart security controls.

WastedLocker appears to have adopted this technique and that adds an additional layer of obfuscation by doing the entire **thing in memory, where it’s harder for a behavioral detection to catch it.**

Before diving into the tricks, you need to know that ransomware defenses based on behavior monitoring typically implement a **minifilter driver**. Minifilter drivers are kernel drivers that attach to the file system stack. Minifilters filter I/O operations in order to keep an eye on everything that happens to files

WastedLocker uses a trick to make it harder for behavior based anti-ransomware solutions to keep track of what is going on: **using memory-mapped I/O to encrypt a file**. Although it is unnecessary for ransomware to access documents as a memory-mapped file (MMF), the method is more common nowadays, as Maze and Clop also employ the same tactic.

**The Memory Manager also keeps any eye on memory that has been modified, so-called dirty pages.** If a process encrypts the mapped memory, the memory manager knows which pages need to be written back to disk. This writing is done by the Cache Manager’s Lazy Writer.

**Anti-ransomware solutions that correlate activity based on CreateFile and CloseFile operations will miss all the disk I/O performed by the Cache Manager in response to mapped memory operations.** This can be observed by the following screenshot:


**Abuse of Alternate Data Streams (ADS)**
--> Great high level description on how ADS abuse works
Both Bitpaymer and WastedLocker abuse ADS in the same way: The malware finds a clean system file, copies itself to the clean file’s ADS, and then executes itself as a service component of the clean file. This makes it appear that the clean file is the source of the ransomware behavior. They both accomplish this using the same technique: They reset the privileges of the targeted system file using icacls.exe in order to add the ADS component, and then copy the clean system file to the %APPDATA% folder.


UAC bypass
Both ransomware use a similar User Account Controls bypass technique to elevate the clean, hijacked process to run the ransomware code (using the ADS technique, above). **Bitpaymer adds a .cmd file to the registry key (“HKCU\Software\Classes\mscfile\shell\open\command”), such that, when an elevated eventvwr.exe file is executed, it checks the registry key (by default) and that, in turn, executes the .cmd** file that runs the ransomware binary. With **WastedLocker, it uses winsat.exe and winmm.dll to run the ransomware binary (ADS component) by patching the winmm.dll.**

https://news.sophos.com/en-us/2020/08/04/wastedlocker-techniques-point-to-a-familiar-heritage/

Tags:
UAS Bypass
ADS abuse
Ransomeware
Memory Encryption
End Point Security Tech
Process Explorer

# Article Operation Hidden Cobera

This recent campaign used malicious documents to install malware on the targeted system using a **template injection attack**. This technique allows a weaponized document to download an external Word template containing macros that will be executed. This is a known trick used to bypass static malicious document analysis, as well as detection, as the macros are embedded in the downloaded template.

As we mentioned, the adversary used a technique called template injection. When a document contains the .docx extension, in our case, it means that we are dealing with the Open Office XML standard. A .docx file is a zip file containing multiple parts. Using the template injection technique, the adversary puts a link towards the template file in one of the .XML files, for example the link is in settings.xml.rels while the external oleobject load is in document.xml.rels. The link will load a template file (DOTM) from a remote server. This is a clever technique we observe being used by multiple adversaries [5] and is intended to make a document appear to be clean initially, only to subsequently load malware. **Some of these template files are renamed as JPEG files when hosted on a remote server to avoid any suspicion and bypass detection.** These template files contain Visual Basic macro code, that will load a DLL implant onto the victim’s system. Current McAfee technologies currently protect against this threat.

https://www.mcafee.com/blogs/other-blogs/mcafee-labs/operation-north-star-a-job-offer-thats-too-good-to-be-true/

# Article Ripple20

**Links**
https://www.zdnet.com/article/ripple20-vulnerabilities-will-haunt-the-iot-landscape-for-years-to-come/

JSOF Report:
https://www.jsof-tech.com/ripple20/

Black Hat Talk Schedule:
https://www.blackhat.com/us-20/briefings/schedule/index.html#hacking-the-supply-chain--vulnerabilities-haunt-tens-of-millions-of-critical-devices-19493

Get Technical Whitepaper:
https://www.jsof-tech.com/ripple20/#ripple-whitepaper

Forescout webpage:
https://www.forescout.com/

**Notes**

The JSOF research lab has discovered a series of zero-day vulnerabilities in a widely used **low-level TCP/IP software library developed by Treck, Inc.**

--------------
**Ripple20 poses a significant risk from the devices still in use. Potential risk scenarios include:**

• An attacker from outside the network taking control over a device within the network, if internet facing.

• An attacker who has already managed to infiltrate a network can use the library vulnerabilities to target specific devices within it.

• An attacker could broadcast an attack capable of taking over all impacted devices in the network simultaneously.

• An attacker may utilize affected device as a way to remain hidden within the network for years

• A sophisticated attacker can potentially perform an attack on a device within the network, from outside the network boundaries, thus bypassing NAT configurations. This can be done by performing a MITM attack or a dns cache poisoning.

• In some scenarios, an attacker may be able to perform attacks from outside the network by replying to packets that leave network boundaries, bypassing NAT

--------------

--------------
**Pre-emptive traffic filtering is an effective technique that can be applied as appropriate to your network environment. Filtering options include:**

• Normalize or block IP fragments, if not supported in your environment.
• Disable or block IP tunneling (IPv6-in-IPv4 or IP-in-IP tunneling), if not required.
• Block IP source routing, and any IPv6 deprecated features, like routing headers VU#267289
• Enforced TCP inspection, rejecting malformed TCP packets.
• Block unused ICMP control messages, such as MTU update and Address Mask updates.
• Normalize DNS through a secure recursive server or DNS inspection firewall.              (Verify that your recursive DNS server normalizes requests.)
• Provide DHCP/DHCPv6 security, with features such as DHCP snooping.
• Disable/Block IPv6 multicast capabilities if not used in the switching infrastructure.
• Disable DHCP where static IPs can be used.
• Employ network IDS and IPS signatures.

• Employ network segmentation, if available.
--------------

Over the course of the disclosure process we found that while patching was difficult for some vendors, **it could potentially be even more difficult or close to impossible for some end users to install the patches.** (For example, if the library is on a separate physical component or the company that produced the component has ceased operations.)


# Article OLD STUFF

```
Glupteba = Botnet

**Report**
https://news.sophos.com/wp-content/uploads/2020/06/glupteba_final.pdf

Tags:
Windows root kit drivers
Crypto Miners
UAC Bypass
Living off the land
Process/File Concealment
Sophos
C2
Blockchain C2 address
Windows Registry special places
Eternal Blue
https://github.com/yelinaung/Go-haikunator
Go/Python/C++
Windows Token Service Perm Steal to escalate 

Kinsing =  cryptominer

Maze = Ransomware

rEvil = Ransomware

'worker.exe' is an
off-the-shelf tool used by multiple threat actors, especially for its
reconnaissance capabilities.


infostealers such as
Vidar, Predator and Raccoon


Lockergoga = Ransomware
Legion Loader = MaaS loader


MyKings botnet


Orcus = RAT tool
WarZone =  RAT tool


Pipka = Javascript Scimmer, **able to remove itself from html**
 
 
#North Korea, some malware from APT38
CHEESETRAY = Backdoor
ROCKEYE = Backdoor
ROGUEEYE = Backdoor

TrickBot: https://blog.malwarebytes.com/detections/trojan-trickbot/


Ryuk =Ransomware


PWNDROID3” and “PWNWIN1 = Mobile App malware

LockerGoga = Ransomware

MageCart = e-skimming 

Robinhood Ransomware
BlueKeep/CVE-2019–0708
```

